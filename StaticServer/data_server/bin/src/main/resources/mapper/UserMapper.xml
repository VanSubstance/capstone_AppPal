<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.appPal.main.mapper.UserMapper">
	<select id="selectUserList" parameterType="UserSearchDto" resultType="UserDto">
		select 
			ut.email
			, ut.password
		from
			user_tb ut
		where
			ut.status = '01'
			<if test="search.email!=null">
			and ut.email = #{search.email}
			</if>
		<choose>
			<when test="search.orderBy=='lastLoginDate'">
		order by ut.reg_date desc
			</when>
			<when test="search.orderBy!='lastLoginDate'">
		order by ut.last_login_date desc
			</when>
		</choose>
	</select>
	
	<insert id="insertUser" parameterType="UserDto">
		insert into user_tb (
			member_key
			, email
			, password
		) 
		values (
			#{user.memberKey}
			, #{user.email}
			, #{user.password}
		)
	</insert>
	
	<select id="selectMemberKey" parameterType="UserDto" resultType="String">
		select
			ut.member_key
		from
			user_tb ut
		where
			status = '01'
			and email = #{user.email}
			and password = #{user.password}
	</select>
	
	<update id="refreshUser" parameterType="UserDto">
		update
			user_tb
		set
			last_login_date = current_timestamp()
		where
			member_key = #{user.memberKey}
	</update>
</mapper>